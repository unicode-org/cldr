<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html><head><!--
Copyright (C) 2004-2005, Unicode, Inc., International Business Machines Corporation, and others.
For terms of use, see http://www.unicode.org/terms_of_use.html
-->

<link rel="stylesheet" type="text/css" href="../common.css">
<title>CLDR Tools &amp; Data Updates</title></head>


<body bgcolor="white">

<h1>Tools</h1>
<p>Provides tools for manipulating CLDR files. <i>&nbsp;Warning: these tools do not have 
much documentation</i></p>
<h3>Terms of Use</h3>
<pre>* All files Copyright (c) 2004-2007, Unicode Inc, and others.  All Rights Reserved.<br>* For terms of use, see <a href="http://unicode.org/copyright.html#Exhibit1">http://unicode.org/copyright.html#Exhibit1</a></pre>
<h2>Overview</h2>
<p><b>The directory C:\cvsdata\unicode stands for wherever the cldr directory is for the locale 
CVS.</b></p>
<table id="table1" style="border-collapse: collapse;" border="1" width="100%">
	<tbody>
	<tr>
		<th>Goal</th>
		<th>Test</th>
		<th>Typical Options</th>
		<th>&nbsp;</th>
	</tr>
	<tr>
		<td>&nbsp;</td>
		<td><i>For speed, UTF-8 files, showing file creation</i></td>
		<td><i>Common Options for all of following</i></td>
		<td>-DCLDR_DTD_CACHE=C:\cldrcache\ -Dfile.encoding=UTF-8 -Xmx700M -DSHOW_FILES -DSHOW</td>
	</tr>
	<tr>
		<td>Canonicalizing format</td>
		<td>CLDRModify </td>
		<td>General verification of vetted data</td>
		<td>-r </td>
	</tr>
	<tr>
		<td rowspan="2">Generating Statistics</td>
		<td rowspan="2">CountItems </td>
		<td rowspan="2">Generate something like:<pre><font size="1">Total Items 66,319<br>Total Resolved Items 1,025,077<br>Unique Paths 4,717<br>Unique Values 45,226<br>Unique Full Paths 9,301</font></pre>
		</td>
		<td>-Dmethod=countItems -DSOURCE=C:\cvsdata\unicode\cldr\cldr_1_4\main\</td>
	</tr>
	<tr>
		<td>-Dmethod=countItems -DSOURCE=C:\cvsdata\unicode\cldr\incoming\vetted\main\</td>
	</tr>
	<tr>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
	</tr>
</tbody>
</table>
<h2>UPDATING CODES</h2>
<p>Periodically, the language, territory, script, currency, and country codes change. This document 
describes how to update CLDR when this happens. For the purposes of this document, / and \ are equivalent.</p>
<p><font color="#ff0000"><i><b>Note: All of this is more complicated than it should be: we need to 
simplify the process. We just haven't gotten there yet with everything else going on!</b></i></font></p>
<p><i><b>The following presumes that CLDR is at C:\cvsdata\unicode\cldr\. Substitute whatever folder 
is appropriate on your system.</b></i></p>
<h3>Update languages, scripts, territories, variants</h3>
<p>This updates language codes, script codes, and territory codes.</p>
<p></p>
<ul>
	<li>First get the latest ISO 639-3 from <a href="http://www.sil.org/iso639-3/download.asp">
	http://www.sil.org/iso639-3/download.asp</a><ul>
	<li>Click on each UTF-8 link, and Save As... without the version number:<ul>
	<li>C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data\iso-639-3.tab</li>
	<li>C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data\iso-639-3_Name_Index.tab</li>
	<li>C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data\iso-639-3-macrolanguages.tab</li>
	<li>C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data\iso-639-3_Retirements.tab</li>
</ul>
	</li>
	<li>Take the latest version of any of the files (like iso-639-3_<font color="#ff0000"><b>20070615</b></font>.tab), 
	and paste into<ul>
	<li>
	<a href="file:///C:/cvsdata/unicode/cldr/tools/java/org/unicode/cldr/util/data/iso-639-3-version.tab">C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data\iso-639-3-version.tab</a> </li>
</ul>
	</li>
</ul>
	</li>
	<li>Go to <a href="http://www.iana.org/assignments/language-subtag-registry">http://www.iana.org/assignments/language-subtag-registry</a> 
	<ul>
		<li>(you can set up a watch for changes in this page with 
		<a href="http://www.watchthatpage.com">http://www.watchthatpage.com</a> )</li>
	</ul>
	</li>
	<li>Save as C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data\language-subtag-registry</li>
	<li>If using Eclipse, refresh the files</li>
	<li>Diff with the old copy (via CVS) to check for consistency</li>
	<li>Any new codes need a corresponding update in supplementalMetadata.xml<ul>
		<li>Run CountItems -DCLDR_DTD_CACHE=C:\cldrcache\ -Dfile.encoding=UTF-8 -DSHOW_FILES -Xmx512M -Dmethod=getSubtagVariables</li>
		<li>Replace sections of supplementalMetadata.xml</li>
		<li>Diff for sanity check</li>
	</ul>
	</li>
	<li>Edit common/main/en.xml to add the new names, based on the Descriptions in the registry file.<ul>
		<li>The format of the registry is screwy: you can use 
		<a href="http://demo.icu-project.org/icu-bin/translit">http://demo.icu-project.org/icu-bin/translit</a> to convert forms like N&amp;#x2019;Ko into N&#8217;Ko</li>
		<li>Diff for sanity check</li>
	</ul>
	</li>
	<li>If the associations to script or territory are known, edit supplementalData.xml<ul>
		<li>for example, add to &lt;languageData&gt;</li>
		<li>&lt;language type="gsw" scripts="Latn" territories="CH"/&gt;</li>
		<li>Diff for sanity check</li>
	</ul>
	</li>
	<li>If the code becomes deprecated, then add to supplementalMetadata under &lt;alias&gt;<ul>
		<li>If there is a single replacement add it.</li>
	</ul>
	</li>
	<li>For territories (regions)<ul>
		<li>Add to the territoryContainment in supplementalData.xml<ul>
			<li>The data for that is at the UN site: 
			<a href="http://unstats.un.org/unsd/methods/m49/m49regin.htm">http://unstats.un.org/unsd/methods/m49/m49regin.htm</a> 
			</li>
			<li>With data from the EU at
			<a href="http://europa.eu/abc/european_countries/index_en.htm">
			http://europa.eu/abc/european_countries/index_en.htm</a> 
			</li>
		</ul>
		</li>
		<li>Add to codeMappings<ul>
		<li>Use the UN mapping above for the 3letter and 3number codes.</li>
		<li>Look at http://earth-info.nga.mil/gns/html/fips_files.html</li>
	</ul>
		</li>
		<li>John will need to add metazone mappings as needed.</li>
		<li>Rick will need to get the country data.</li>
		<li>George will need to add the currency data.</li>
		<li><strike>Update util/data/territory_codes.txt</strike><ul>
			<li><strike>This step will be different once the data is moved into SupplementalData.xml</strike></li>
			<li><strike>Todo: fix GenerateEnums around Utility.getUTF8Data("territory_codes.txt");</strike></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>Then run GenerateEnums.java, and make sure it completes with no exceptions.</li>
	<li>Run ConsoleCheckCLDR -f(en) -c comprehensive<ul>
		<li>If you missed any codes, you will get error message: "Unexpected Attribute Value"</li>
		<li>Ignore unconnected coverage errors.</li>
	</ul>
	</li>
	<li>Do <a href="#Likely_Subtags">Likely_Subtags</a></li>
</ul>
<p></p>
<h3>Update New Currency Codes</h3>
<p></p>
<ul>
	<li>Go to <a href="http://www.iso.org/iso/en/prods-services/popstds/currencycodeslist.html">http://www.iso.org/iso/en/prods-services/popstds/currencycodeslist.html</a> 
<ul>
	<li>(you can set up a watch for changes in this page with <a href="http://www.watchthatpage.com">http://www.watchthatpage.com</a> )</li>
	<li><b>WARNING: this needs to be checked periodically, since ISO does not keep accurate histories!</b></li>
	<li>Best is to get on the notification list. If one is missed, try<ul>
		<li>http://web.archive.org/web/*sa_/http://www.iso.org/iso/en/prods-services/popstds/currencycodeslist.html</li>
	</ul></li>
	<li>Also see <a href="http://publications.europa.eu/code/en/en-5000700.htm">http://publications.europa.eu/code/en/en-5000700.htm</a>&nbsp; for background info.</li>
</ul>
	</li>
	<li>Save the page as&nbsp;C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data/currency_codes_list-1.htm</li><ul><li>Sanity check against the old, and check it in.</li></ul><li>Run the program ExtractIsoCurrencyData, with the input being that file and the output being currencycodeslist.txt</li><ul><li>You should now have a cleaned-up, tab-delimited plaintext file, at&nbsp;currencycodeslist.txt</li></ul>
	<ul><li>Use CVS Diff to verify the contents, and check in.</li></ul>
	<ul><li>If you are using Eclipse, refresh the file system (F5)</li></ul>
	<li>Run CountItems -Dmethod=generateCurrencyItems to generate the new currency list.<ul>
	<li>Verify that no currencies are removed. If one would be, add it to IsoCurrencyParser.oldValues, and rerun CountItems.</li>
	<li>It will print a list of items at the end that need to be added to the ISO4217.txt file. Add as 
described below.</li>
	<li>CountItems will also list the data from the file, for cross-checking SupplementalData</li>
	
	<li>If any country changes the use of a currency, verify that there is a corresponding entry in SupplementalData</li>
	<li>Since ISO doesn't publish the exact data change (!), just make sure it is ballpark.</li>
	<li>For new stuff, see below.</li>
</ul>
	</li>
	<li>Adding a currency:<ul>
	<li>In SupplementalData:</li>
	<li>If it has unusual rounding or number of digits, add to:<ul>
	<li>&lt;fractions&gt;</li>
	<li>&lt;info iso4217="ADP" digits="0" rounding="0"/&gt;</li>
	<li>...</li>
</ul>
	</li>
	<li>For each country in which it comes into use, add a line for when it becomes valid<ul>
	<li>&lt;region iso3166="TR"&gt;</li>
	<li>&lt;currency iso4217="TRY" from="2005-01-01"/&gt;</li>
</ul>
	</li>
	<li>Add the code to the file java/org/unicode/cldr/util/data/ISO4217.txt. This is important, since it 
is used to get the valid codes for the survey tool.<ul>
	<li>Example:<ul>
		<li>currency | TRY | new Turkish Lira | TR | TURKEY | C</li>
	</ul></li>
	<li>Mark the old code in java/org/unicode/cldr/util/data/ISO4217.txt as deprecated.<ul>
	<li>currency | TRL | Old Turkish Lira | TR | TURKEY | O</li>
</ul></li>
</ul></li>
</ul></li>
	<li>Changing currency.<ul>
	<li>If the currency goes out of use in a country, then add the last day of use, such as:<ul>
	<li>&lt;region iso3166="TR"&gt;</li>
	<li>&lt;currency iso4217="TRL" from="1922-11-01"/&gt;</li>
	<li>=&gt;</li>
	<li>&lt;region iso3166="TR"&gt;</li>
	<li>&lt;currency iso4217="TRL" from="1922-11-01" to="2005-12-31"/&gt;</li>
</ul></li>
	<li>Edit common/main/en.xml to add the new names (or change old ones) based on the descriptions.<ul>
	<li>If there is a collision between a new and old name, the old one typically changes to<ul>
		<li>"old X" or "X (1983-2003)".</li>
	</ul></li>
</ul></li>
	<li>Run CountItems -DCLDR_DTD_CACHE=C:\cldrcache\ -Dfile.encoding=UTF-8 -DSHOW_FILES -Xmx512M -Dmethod=getSubtagVariables<ul>
		<li>Replace the section of supplementalMetadata.xml &lt;variable id="$currency" type="choice"&gt;</li>
	</ul>
	</li>
</ul></li>
</ul>
<p></p>
<h3>Update New Timezone Database</h3>
<p>Do the following to update to a new timezone database.</p>
<ol type="A">
	<li>Download the latest version of the data from <a href="ftp://elsie.nci.nih.gov/pub/">ftp://elsie.nci.nih.gov/pub/</a> 
	<ul>
		<li>The file you care about will look like tzdata<font color="#0000ff">2007g</font>.tar.gz 
		(with perhaps different year/letter)</li>
		<li>Unpack, and copy contents into C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data</li>
		<li>Edit
the file
C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data\tzdb-version.txt
to change the version, eg for the file tzdata2007a.tar.gz, the version
is 2007a.</li>
		<li>If you are using Eclipse, remember to refresh the project.</li>
	</ul></li>
	<li>Diff zone.tab with CVS.<ul>
		<li>if any IDs in zone.tab changed name, add the mapping to org.unicode.cldr.util.ZoneParser.FIX_UNSTABLE_TZID_DATA</li>
		<li>The format is &lt;new name&gt;, &lt;old name&gt;<ul>
		<li>Eg {"America/Argentina/Buenos_Aires", "America/Buenos_Aires"},</li>
	</ul></li>
	</ul></li>
	<li>Now Verify<ul>
		<li>Run CountItems -Dmethod=genSupplementalZoneData to generate new data.</li>
		<li>Paste the &lt;zoneFormatting&gt; ... &lt;/zoneFormatting&gt; into supplementalData.xml</li>
		<li>Paste the &lt;variable id="$tzid" type="choice"&gt; ... &lt;/variable&gt;&nbsp; into supplementalMetadata.xml</li><li>It also creates a file prettyPathZone.txt. Copy that to util/data/</li>
		<li>Produce Diffs in CVS for all three files files.</li>
		<li><font color="#ff0000"><b>CAREFULLY COMPARE THE RESULTS TO THE LAST VERSION FOR BOTH</b></font></li>
		<li>In supplementalData.xml, any changed name from zone.tab must show a diff like:<ul>
		<li>old: &lt;zoneItem type="Atlantic/Faeroe" territory="FO"/&gt;</li>
		<li>new: &lt;zoneItem type="Atlantic/Faeroe" territory="FO" aliases="Atlantic/Faroe"/&gt;</li>
	</ul></li>
		<li>That is, the old name must not change, just add new aliases.</li>
		<li>In both files, any new zone.tab ID must show up, eg.<ul>
		<li>supplementalData.xml, new: &lt;zoneItem type="Australia/Eucla" territory="AU"/&gt;</li>
		<li>supplementalMetadata.xml, new: Australia/Eucla</li>
	</ul></li>
	</ul></li><li>REMOVE IDs. This doesn't happen very often, but requires some real thought when it does.<ul>
		<li>If there are any $tzid's that are in the last version that are not in the current,</li>
		<li>find out what "real" alias it should point to. There are 2 types.</li>
		<li>1. ID was removed completely, like HST. In that case, there will be no item or alias in zoneItem's.<ul>
			<li>Look at the old supplemental data to determine what it used to map to (eg Pacific/Honolulu)</li>
			<li>Add to supplementalMetaData</li>
			<ul><li>&lt;zoneAlias type="HST" replacement="Pacific/Honolulu"/&gt;</li></ul>
			<li>Add ZoneParser.ADD_ZONE_ALIASES_DATA</li>
			<ul><li>eg {"HST", "Pacific/Honolulu"},</li></ul>
			<li>Rerun CountItems.genSupplementalZoneData()</li>
		</ul></li>
		<li>2. ID is no longer in zone.tab (after fixing "A"), but is still linked.<ul>
			<li>In that case, there will still be a zoneItem as an alias, eg<ul>
				<li>&lt;zoneItem type="Africa/Bamako" territory="ML" aliases="Africa/Timbuktu"/&gt;</li>
			</ul></li>
			<li>Add to supplementalMetadata. Use the zoneItem info<ul>
				<li>&lt;zoneAlias type="Africa/Timbuktu" replacement="Pacific/Honolulu"/&gt;</li>
			</ul></li>
			<li>Add to CountItems.FIX_DEPRECATED_ZONE_DATA. Example:<ul>
				<li>"Africa/Timbuktu",</li>
			</ul></li>
			<li>Rerun CountItems.genSupplementalZoneData()</li>
			<li>Sometimes the aliases will be on the wrong element. If so, add to org.unicode.cldr.util.ZoneParser.PREFERRED_BASES.</li>
		</ul>
		<p>
	</p></li></ul></li>
	<li>Repeat C and D until no changes occur.<ul>
		<li>When you are all done, there should ONLY be additions to $tzid and zoneItem's.</li>
	</ul>
  <li>For any of the timezones that are added, changed, or deleted, you
will need to make the appropriate metazone updates to
supplemental/metazoneInfo.xml.&nbsp; For each zone, you will need to
read the Olson TZ data file ( they are grouped by continent ), and
compute the transition times ( in GMT, not local time ) for any
metazone transitions.&nbsp; A metazone transition usually occurs when
the abbreviation changes, for example, from E%sT to C%sT.&nbsp; If a
zone is simply starting or stopping observence of DST, then usually no
metazone transition is necessary.&nbsp; Example, going from E%sT to EST
is NOT a metazone transition.<br>
    <br>
  </li>
	<p>
	</p></li><li>Check in the new supplemental files and the data files in ...org\unicode\cldr\util\data<ul>
		<li>just the data files that are already checked in (eg check in 'africa', but not 'factory')</li>
		<li>(Note: the code in CountItems and StandardCodes means that we have to duplicate a bit of process 
above, but for now it's not worth fixing.)</li>
	</ul></li>
</ol>
<p></p>
<p></p>
<h3>Update new Language/Script/Country Information</h3>
<ol>
	<li>Get the spreadsheets from Rick, with names of the form:<ol>
	<li><b>country_language_population-0403.xls</b></li>
	<li><b>language_script_0403.txt</b><ol>
	<li><b>Alt must be secondary if <i>any</i> of the following are true:</b><ul>
		<li><b>the script is not modern</b></li>
		<li><b>the language is not modern</b></li>
		<li><b>the territory doesn't have the language as a major modern language (official or 
		defacto-official).</b></li>
	</ul>
	</li>
</ol>
	</li>
</ol>
	</li>
	<li>Open, and pick the Save As... menu<ol>
	<li>Pick "Save as type:" Text (Tab delimited) (*.txt)</li>
	<li>And "File name:" C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data\country_language_population<b>_raw</b>.txt</li>
	<li>Save, responding OK, Yes; then close Excel (clicking No)</li>
	<li>In CVS, diff C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data\country_language_population_raw.txt 
and sanity-check the changes.</li>
	<li>Do the same to generate C:\cvsdata\unicode\cldr\tools\java\org\unicode\cldr\util\data\language_script<b>_raw</b>.txt</li>
</ol>
	</li>
	<li>Run the tool ConvertLanguageData.<ol>
	<li>Look for failures in the language vs script data, following the line:<ul>
		<li><b>Problems in language_script_raw.txt</b></li>
	</ul>
	</li>
	<li>Look for Territory Language data, following the line:<ul>
		<li><b>Possible Failures</b> ...
		<ul>
			<li>In Basic Data but not Population &gt; 20%</li>
			<li>and the reverse.</li>
		</ul>
		</li>
	</ul>
	</li>
	<li>Look for general problems, following the line:<ul>
		<li><b>Failures in Output.</b></li>
		<li>It will also warn if a country doesn't have an official or de facto official language.</li>
	</ul>
	</li>
	<li>Send all the error reports back to Rick.</li>
</ol>
	</li>
	<li>Once the errors are straightened out, diff the
following two files as a sanity check. The fragment only has certain
portions of supplemental data, so ignore the parts it doesn't have:<ul>
		<li>C:\cvsdata\unicode\cldr\common\supplemental\supplementalData.xml</li>
		<li>C:\cvsdata\unicode\cldr\dropbox\gen\supplemental\language_code_fragment.xml</li>
	</ul>
	</li>
	<li>Also compare the following (for the defaultContent section only)
	<ul>
		<li>C:\cvsdata\unicode\cldr\common\supplemental\supplementalMetadata.xml</li>
		<li>C:\cvsdata\unicode\cldr\dropbox\gen\supplemental\language_code_fragment_metadata.xml</li>
	</ul>
	</li>
	<li>If all looks well, paste in the sections into supplementalData.xml<ul>
		<li>&lt;territoryInfo&gt;</li>
		<li>&lt;references&gt;</li>
	</ul>
	</li>
	<li>And into supplementalMetadata.xml<ul>
		<li>&lt;defaultContent&gt;</li>
	</ul>
	</li>
	<li>Then run QuickCheck to verify that the DTD is in order, and check in.</li>
	<li>Do <a href="#Likely_Subtags">Likely_Subtags</a></li>
</ol>
<h3><a name="Likely_Subtags">Likely Subtags </a></h3>
<ol>
	<li>Then run GenerateMaximalLocales to generate the likely subtag data.
<ol>
	<li>Copy <a href="file:///C:/cvsdata/unicode/cldr/dropbox/gen/">
	C:\cvsdata\unicode\cldr\dropbox\gen\</a> likelySubtags.xml to
	<a href="file:///C:/cvsdata/unicode/cldr/common/supplemental">
	C:\cvsdata\unicode\cldr\common\supplemental</a>&nbsp; </li>
	<li>Diff, Sanity Check, check in.</li>
</ol></li>
	<li>Run GenerateLikelySubtagTests<ol>
	<li>Copy <a href="file:///C:/cvsdata/unicode/cldr/dropbox/gen/">
	C:\cvsdata\unicode\cldr\dropbox\gen\</a> likelySubtagTests.xml to
	<a href="file:///C:/cvsdata/unicode/cldr/common/test/supplemental/">
	C:\cvsdata\unicode\cldr\common\test\supplemental\</a> </li>
	<li>Diff, Sanity Check, check in.</li>
</ol></li>
	<li>Then run ShowLanguages to generate the charts. Sanity check them, and check in.</li>
	<li>Run ShowLanguages -DSHOW_FILES to regenerate the supplemental.html charts<ul>
		<li>Generate them in ...\unicode\cldr\diff\supplemental\...</li>
		<li>Post to <a href="http://www.unicode.org/cldr/data/diff/supplemental/supplemental.html">http://www.unicode.org/cldr/data/diff/supplemental/supplemental.html</a></li>
	</ul>
	</li>
</ol>
<h3>Update IANA/FIPS/ISO Mappings</h3>
<ul>
	<li>TBD - Describe what to do. The URLs are<ul>
		<li><a href="http://www.iana.org/domain-names.htm">http://www.iana.org/domain-names.htm</a></li>
		<li><a href="http://www.iana.org/root-whois/index.html">http://www.iana.org/root-whois/index.html</a></li>
		<li><a href="http://data.iana.org/TLD/tlds-alpha-by-domain.txt">http://data.iana.org/TLD/tlds-alpha-by-domain.txt</a></li>
	</ul>
	</li>
</ul>

</body></html>
